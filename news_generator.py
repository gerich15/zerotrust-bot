import openai
import random
from datetime import datetime, timedelta
from config import Config

openai.api_key = Config.OPENAI_API_KEY


class NewsGenerator:
    @staticmethod
    def generate_cybersecurity_news():
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""

        news_types = [
            "–Ω–æ–≤–æ–µ —É—è–∑–≤–∏–º–æ—Å—Ç—å –∏ –ø–∞—Ç—á",
            "–∫–∏–±–µ—Ä–∞—Ç–∞–∫–∞ –Ω–∞ –∫—Ä—É–ø–Ω—É—é –∫–æ–º–ø–∞–Ω–∏—é",
            "–Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–µ–Ω—Ç–µ—Å—Ç–∞",
            "–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ",
            "–æ—Ç—á–µ—Ç –æ —Ç—Ä–µ–Ω–¥–∞—Ö –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
            "–∏–Ω—Ç–µ—Ä–≤—å—é —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
        ]

        news_type = random.choice(news_types)

        prompt = f"""
        –ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫—É—é –Ω–æ–≤–æ—Å—Ç—å –¥–ª—è Telegram –∫–∞–Ω–∞–ª–∞ –æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
        
        –¢–∏–ø –Ω–æ–≤–æ—Å—Ç–∏: {news_type}
        –§–æ—Ä–º–∞—Ç: –∑–∞–≥–æ–ª–æ–≤–æ–∫ ‚Üí –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        –°—Ç–∏–ª—å: –Ω–æ–≤–æ—Å—Ç–Ω–æ–π, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π, —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞
        –î–ª–∏–Ω–∞: 150-250 —Å–ª–æ–≤
        –î–æ–±–∞–≤—å —ç–º–æ–¥–∑–∏ –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ
        –•–µ—à—Ç–µ–≥–∏: {", ".join(random.sample(Config.HASHTAGS, 4))}
        
        –°–¥–µ–ª–∞–π –Ω–æ–≤–æ—Å—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏ –ø–æ–ª–µ–∑–Ω–æ–π –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
        """

        try:
            response = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=[
                    {
                        "role": "system",
                        "content": "–¢—ã –Ω–æ–≤–æ—Å—Ç–Ω–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑–¥–∞–Ω–∏—è –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.",
                    },
                    {"role": "user", "content": prompt},
                ],
                max_tokens=400,
            )

            return f"üì∞ –ö–ò–ë–ï–†–ù–û–í–û–°–¢–ò:\n\n{response.choices[0].message.content.strip()}"
        except:
            return "üö® –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏. #–ö–∏–±–µ—Ä–Ω–æ–≤–æ—Å—Ç–∏ #–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
